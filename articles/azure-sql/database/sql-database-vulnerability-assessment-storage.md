---
title: Speichern der Ergebnisse von Überprüfungen zur Sicherheitsrisikobewertung in einem Speicherkonto, auf das hinter Firewalls oder VNETs zugegriffen werden kann
description: Enthält Anleitungen zum Speichern von Überprüfungen zur Sicherheitsrisikobewertung in einem Speicherkonto, auf das über eine Firewall oder ein VNET zugegriffen werden kann.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 12/01/2020
ms.openlocfilehash: c2a8d9420485b10716619388f58afb01af5ea623
ms.sourcegitcommit: 80d311abffb2d9a457333bcca898dfae830ea1b4
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 05/26/2021
ms.locfileid: "110468837"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>Speichern der Ergebnisse von Überprüfungen zur Sicherheitsrisikobewertung in einem Speicherkonto, auf das hinter Firewalls oder VNETs zugegriffen werden kann
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

Wenn Sie den Zugriff auf Ihr Speicherkonto in Azure für bestimmte VNETs oder Dienste einschränken, müssen Sie die entsprechende Konfiguration aktivieren, damit die Überprüfung zur Sicherheitsrisikobewertung für SQL-Datenbanken oder verwaltete Instanzen auf dieses Speicherkonto zugreifen kann.

## <a name="prerequisites"></a>Voraussetzungen

Der Dienst zur Sicherheitsrisikobewertung für SQL benötigt Berechtigung für das Speicherkonto, um Baseline- und Überprüfungsergebnisse zu speichern.  Es gibt drei Methoden: 
- **Verwendung des Speicherkontoschlüssels**: Azure erstellt den SAS-Schlüssel und speichert ihn (wir speichern den Kontoschlüssel jedoch nicht).
- **Verwendung des SAS-Schlüssel für den Speicher**: Der SAS-Schlüssel muss über folgende Berechtigungen verfügen: Schreiben | Auflisten | Lesen | Löschen.
- **Verwendung der verwalteten SQL Server-Identität**: Der SQL Server muss über eine verwaltete Identität verfügen. Das Speicherkonto muss über eine Rollenzuweisung für die verwaltete SQL-Identität als StorageBlobContributor verfügen. Wenn Sie die Einstellungen anwenden, müssen die VA-Felder „storageContainerSasKey“ und „storageAccountAccessKey“ leer sein. Wenn sich der Speicher hinter einer Firewall oder einem virtuellen Netzwerk befindet, ist die verwaltete SQL-Identität unbedingt erforderlich. 

Wenn Sie das Azure-Portal zum Speichern von SQL-VA-Einstellungen verwenden, überprüft Azure, ob Sie über die Berechtigung zum Zuweisen einer neuen Rollenzuweisung für die verwaltete Identität als StorageBlobContributor im Speicher verfügen. Wenn Berechtigungen zugewiesen sind, verwendet Azure die verwaltete SQL Server-Identität, andernfalls verwendet Azure die Schlüsselmethode. 

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>Aktivieren des Zugriffs auf das Speicherkonto für Überprüfungen zur Sicherheitsrisikobewertung bei Azure SQL-Datenbank

Wenn Sie Ihr Speicherkonto für Überprüfungen zur Sicherheitsrisikobewertung so konfiguriert haben, dass es nur für bestimmte Netzwerke oder Dienste zugänglich ist, müssen Sie sicherstellen, dass diese Überprüfungen für Ihre Azure SQL-Datenbank im Speicherkonto gespeichert werden können. Sie können das vorhandene Speicherkonto verwenden oder ein neues Speicherkonto erstellen, um die Ergebnisse der Überprüfungen zur Sicherheitsrisikobewertung für alle Datenbanken auf Ihrem [logischen SQL-Server](logical-servers.md) zu speichern.

> [!NOTE]
> Der Dienst zur Bewertung von Sicherheitsrisiken kann nicht auf Speicherkonten zugreifen, die mit Firewalls oder VNets geschützt sind, wenn sie Speicherzugriffsschlüssel erfordern.

Wechseln Sie zu Ihrer **Ressourcengruppe** mit dem Speicherkonto, und greifen Sie auf den Bereich **Speicherkonto** zu. Wählen Sie unter **Einstellungen** die Option **Firewall und virtuelle Netzwerke** aus.

Vergewissern Sie sich, dass das Kontrollkästchen **Vertrauenswürdigen Microsoft-Diensten den Zugriff auf dieses Speicherkonto erlauben** aktiviert ist.

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="Screenshot mit dem Dialogfeld „Firewall und virtuelle Netzwerke“ und ausgewählter Option „Vertrauenswürdigen Microsoft-Diensten den Zugriff auf dieses Speicherkonto erlauben“":::

Wenn Sie herausfinden möchten, welches Speicherkonto verwendet wird, wechseln Sie im [Azure-Portal](https://portal.azure.com) zu Ihrem Bereich **SQL-Server**, und wählen Sie unter **Sicherheit** die Option **Security Center** aus.

:::image type="content" source="../database/media/azure-defender-for-sql/va-storage.png" alt-text="Einrichten der Sicherheitsrisikobewertung":::

> [!NOTE]
> Sie können E-Mail-Benachrichtigungen einrichten, um Benutzer in Ihrer Organisation zu benachrichtigen, dass sie die Überprüfungsberichte anzeigen oder öffnen sollen. Dazu muss sichergestellt sein, dass Sie über Berechtigungen als SQL-Sicherheits-Manager und Leser von Speicherblobdaten verfügen.

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>Speichern Sie die Ergebnisse der Überprüfungen zur Sicherheitsrisikobewertung für die verwaltete Azure SQL-Datenbank-Instanz in einem Speicherkonto, auf das hinter einer Firewall oder einem VNET zugegriffen werden kann.

Da „Verwaltete Instanz“ kein vertrauenswürdiger Microsoft-Dienst ist und über ein anderes VNET als das Speicherkonto verfügt, führt das Ausführen einer Überprüfung zur Sicherheitsrisikobewertung zu einem Fehler.

Führen Sie zur Unterstützung von Überprüfungen zur Sicherheitsrisikobewertung für verwaltete Instanzen die nachstehenden Schritte aus:

1. Klicken Sie im Bereich **Verwaltete SQL-Instanz** unter der Überschrift **Übersicht** auf den Link **Virtuelles Netzwerk/Subnetz**. Dadurch gelangen Sie zum Bereich **Virtuelles Netzwerk**.

   :::image type="content" source="../managed-instance/media/public-endpoint-configure/mi-overview.png" alt-text="mi-overview2":::

1. Wählen Sie unter **Einstellungen** die Option **Subnetze** aus. Klicken Sie in dem neuen Bereich auf **Subnetz**, um ein Subnetz hinzuzufügen, und delegieren Sie es an *Microsoft.Sql\managedInstance*. Weitere Informationen finden Sie unter [Verwalten von Subnetzen](../../virtual-network/virtual-network-manage-subnet.md).

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="Screenshot mit einem Subnetz, das an Microsoft.sql\managedinstance delegiert wurde":::

1. Wählen Sie in Ihrem Bereich **Virtuelles Netzwerk** unter **Einstellungen** die Einstellung **Dienstendpunkte** aus. Klicken Sie im neuen Bereich auf **Hinzufügen**, und fügen Sie den Dienst *Microsoft.Storage* als neuen Dienstendpunkt hinzu. Vergewissern Sie sich, dass das Subnetz *ManagedInstance* ausgewählt ist. Klicken Sie auf **Hinzufügen**.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="Screenshot mit der Option „Dienstendpunkte hinzufügen“ zum Hinzufügen des Diensts Microsoft.Storage als Endpunkt.":::

1. Wechseln Sie zu Ihrem **Speicherkonto**, das Sie zum Speichern Ihrer Überprüfungen zur Sicherheitsrisikobewertung ausgewählt haben. Wählen Sie unter **Einstellungen** die Option **Firewall und virtuelle Netzwerke** aus. Klicken Sie auf **Vorhandenes virtuelles Netzwerk hinzufügen**. Wählen Sie das virtuelle Netzwerk und das Subnetz Ihrer verwalteten Instanz aus, und klicken Sie auf **Hinzufügen**.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="Screenshot des Bereichs „Firewalls und virtuelle Netzwerke“ mit dem Link „Vorhandenes virtuelles Netzwerk hinzufügen“":::

Jetzt sollten Sie Ihre Überprüfungen zur Sicherheitsrisikobewertung für verwaltete Instanzen in Ihrem Speicherkonto speichern können.

## <a name="troubleshoot-vulnerability-assessment-scan-related-issues"></a>Behandeln von Überprüfungsproblemen bei der Sicherheitsrisikobewertung 

Behandeln sie häufige Probleme im Zusammenhang mit Überprüfungen der Sicherheitsrisikobewertung.

### <a name="failure-to-save-vulnerability-assessment-settings"></a>Fehler beim Speichern der Einstellungen für die Sicherheitsrisikobewertung

Möglicherweise können Sie Änderungen an den Einstellungen für die Sicherheitsrisikobewertung nicht speichern, wenn das Speicherkonto einige Voraussetzungen nicht erfüllt oder wenn Sie über unzureichende Berechtigungen verfügen.

#### <a name="storage-account-requirements"></a>Anforderungen an das Speicherkonto

Das Speicherkonto, in dem die Überprüfungsergebnisse der Sicherheitsrisikobewertung gespeichert werden, muss die folgenden Anforderungen erfüllen:

- **Typ**: StorageV2 (Universell V2) oder Storage (Universell V1)
- **Leistung**: Standard (ausschließlich)
- **Region**: Der Speicher muss sich in derselben Region wie die Azure SQL Server-Instanz befinden.

Wenn eine dieser Anforderungen nicht erfüllt ist, können Änderungen an den Einstellungen für die Sicherheitsrisikobewertung nicht gespeichert werden.

#### <a name="permissions"></a>Berechtigungen 

Um Änderungen an den Einstellungen für die Sicherheitsrisikobewertung zu speichern, sind die folgenden Berechtigungen erforderlich:

- SQL-Sicherheits-Manager
- Leser von Speicherblobdaten

Zum Festlegen einer neuen Rollenzuweisung sind Zugriffsrechte als Besitzer oder Benutzeradministrator auf das Speicherkonto und die folgenden Berechtigungen erforderlich:

- Besitzer von Speicherblobdaten

### <a name="storage-account-isnt-visible-for-selection-in-vulnerability-assessment-settings"></a>Das Speicherkonto ist in den Einstellungen der Sicherheitssicherheitsbewertung für die Auswahl nicht sichtbar

Das Speicherkonto kann aus verschiedenen Gründen nicht in der Speicherkontoauswahl nicht angezeigt werden:

- Das gesuchte Speicherkonto befindet sich nicht im ausgewählten Abonnement.
- Das gesuchte Speicherkonto befindet sich nicht in derselben Region wie die Azure SQL Server-Instanz.
- Sie verfügen nicht über Microsoft.Storage/storageAccounts/read-Berechtigungen für das Speicherkonto.

### <a name="failure-to-open-an-email-link-for-scan-results-or-cant-view-scan-results"></a>Öffnen des E-Mail-Links für Überprüfungsergebnisse oder Anzeigen der Überprüfungsergebnisse nicht möglich

Möglicherweise können Sie einen Link in einer Benachrichtigungs-E-Mail für Überprüfungsergebnisse nicht öffnen oder keine Überprüfungsergebnisse anzeigen, wenn Sie nicht über die erforderlichen Berechtigungen verfügen oder einen Browser verwenden, der das Öffnen oder Anzeigen von Überprüfungsergebnissen nicht unterstützt.

#### <a name="permissions"></a>Berechtigungen

Um Links in E-Mail-Benachrichtigungen für Überprüfungsergebnisse zu öffnen oder Überprüfungsergebnisse anzuzeigen, sind die folgenden Berechtigungen erforderlich:

- SQL-Sicherheits-Manager
- Leser von Speicherblobdaten

#### <a name="browser-requirements"></a>Browseranforderungen

Das Öffnen oder Anzeigen der Ansicht mit den Überprüfungsergebnissen im Firefox-Browser wird nicht unterstützt. Es wird empfohlen, Chrome oder Microsoft Edge zu verwenden, um die Überprüfungsergebnisse von Sicherheitsrisikobewertungen anzuzeigen.

## <a name="next-steps"></a>Nächste Schritte

- [Sicherheitsrisikobewertung](sql-vulnerability-assessment.md)
- [Erstellen Sie ein Azure Storage-Konto.](../../storage/common/storage-account-create.md)
- [Azure Defender für SQL](azure-defender-for-sql.md)
